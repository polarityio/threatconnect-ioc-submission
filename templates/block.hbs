<div
  class="{{if
      (and (not (or newIocs.length newIocsToSubmit.length)) interactionDisabled)
      ' modal-open'
    }}
    {{if showOwnershipMessage 'ownership-modal-open'}}"
>
  {{#if foundEntities.length}}
    {{#if isDeleting}}
      <div class="ioc-deletion-modal">
        <div class="note">
          <span class="p-key">
            <span class="p-value"><em><b>DANGER:</b></em></span>
            <div>
              <span>Deleting an indicator cannot be undone and will remove all data for
                the indicator in ThreatConnect.</span>
            </div>
            <div>
              <span>Are you sure you want to delete the indicator
                <em><b>{{entityToDelete.value}}</b></em>?</span>
            </div>
          </span>
          <div class="delete-confirmation-button">
            <button class="cancel-delete" {{action "cancelItemDeletion"}}>Cancel</button>
            <button
              class="p-btn btn btn-danger m-0"
              {{action "confirmDelete"}}
            >Delete</button>
          </div>
        </div>
      </div>
    {{/if}}

    {{#if isInMyOwner}}
      <h1 class="p-title">
        {{fa-icon "info-circle" size="sm"}}
        Found in ThreatConnect
      </h1>
      <table class="w-100">
        <tbody>
          {{#each foundEntities as |foundEntity|}}
            <tr>
              <td>
                {{#if (not interactionDisabled)}}
                  <div class="url-column">
                    {{#if (eq foundEntity.ownershipStatus "inMyOwner")}}
                      <span>{{foundEntity.owner.name}}</span>
                      <div class="owner-row">
                        <a
                          href="{{details.uiUrl}}/#/details/indicators/{{if
                            foundEntity.createdIndicatorsId
                            foundEntity.createdIndicatorsId
                            foundEntity.indicatorId
                          }}/overview"
                        >
                          {{foundEntity.value}}{{if (not foundEntity.canDelete) "*"}}
                          {{fa-icon
                            "external-link"
                            fixedWidth=true
                            class="external-link-icon"
                          }}
                        </a>
                        <span class="type">{{foundEntity.displayedType}}</span>
                        {{#if (and block.userOptions.allowDelete foundEntity.canDelete)}}
                          <button
                            class="no-style-button delete"
                            {{action "initiateItemDeletion" foundEntity}}
                            title="Delete IOC from ThreatConnect"
                            disabled={{interactionDisabled}}
                          >
                            {{fa-icon "trash" fixedWidth=true}}
                          </button>
                        {{/if}}
                      </div>
                    {{/if}}
                  </div>
                {{else}}
                  <a>
                    {{foundEntity.value}}
                    {{fa-icon "external-link" fixedWidth=true class="external-link-icon"}}
                  </a>
                {{/if}}
              </td>
            </tr>
          {{/each}}
        </tbody>
      </table>
    {{/if}}

    {{#if isNotInMyOwner}}
      <h1 class="p-title">
        {{fa-icon "info-square" size="sm"}}
        Found in ThreatConnect but not in owner account
      </h1>
      {{#each foundEntities as |foundEntity|}}
        {{#if (eq foundEntity.ownershipStatus "notInMyOwner")}}
          <div>
            <div
              class="expand-container"
            >
              <span class="p-action" {{action "toggleIsExpanded" foundEntity}}>{{foundEntity.value}}
                {{#if foundEntity.isExpanded}}
                  {{fa-icon icon="chevron-up" class="p-action" fixedWidth=true}}
                {{else}}
                  {{fa-icon icon="chevron-down" class="p-action" fixedWidth=true}}
                {{/if}}
              </span>
              {{#if foundEntity.isExpanded}}
                <table class="w-100 mt-1">
                  <tbody>
                  <tr>
                    <td>
                      {{#if (not interactionDisabled)}}
                        <div class="url-column">
                          {{#each foundEntity.owners as |owner|}}
                            {{#if (eq foundEntity.ownershipStatus "notInMyOwner")}}
                              <span style="color: black;">{{owner.name}}</span>
                              <div class="owner-row">
                                <a
                                        href="{{details.uiUrl}}/#/details/indicators/{{if
                                                foundEntity.rawValue
                                                owner.itemId
                                                foundEntity.indicatorId
                                        }}/overview"
                                >
                                  {{foundEntity.value}}{{if
                                        (not foundEntity.canDelete)
                                        "*"
                                }}
                                  {{fa-icon
                                          "external-link"
                                          fixedWidth=true
                                          class="external-link-icon"
                                  }}
                                </a>
                                <span class="type">{{foundEntity.displayedType}}</span>
                                {{#if (not foundEntity.canDelete)}}
                                  <button
                                          class="no-style-button add-found"
                                    {{action "addSubmitItem" foundEntity}}
                                          title="Add IOC from Submission List for your Instance"
                                          disabled={{interactionDisabled}}
                                  >
                                    {{fa-icon "plus" fixedWidth=true}}
                                  </button>
                                {{/if}}
                              </div>
                            {{/if}}
                          {{/each}}
                        </div>
                      {{else}}
                        <a>
                          {{foundEntity.value}}
                          {{fa-icon
                                  "external-link"
                                  fixedWidth=true
                                  class="external-link-icon"
                          }}
                        </a>
                      {{/if}}
                    </td>
                  </tr>
                  </tbody>
                </table>
              {{/if}}
            </div>
          </div>
        {{/if}}
      {{/each}}
    {{/if}}

    <div class="d-flex flex-row justify-content-between align-items-center">
      <div>
        {{#if deleteIsRunning}}
          {{fa-icon "spinner-third" fixedWidth=true spin=true}}
          Deleting...
        {{/if}}
      </div>

      {{#if deleteMessage}}
        <div class="alert alert-info mt-1">
          {{deleteMessage}}
        </div>
      {{/if}}
      {{#if deleteErrorMessage}}
        <div class="alert alert-danger mt-1">
          {{deleteErrorMessage}}
        </div>
      {{/if}}
    </div>
  {{/if}}

  {{#if exclusionListEntities.length}}
    <div
      class="{{if
          (and (not (or exclusionListEntities.length)) interactionDisabled)
          ' modal-open'
        }}
        {{if showOwnershipMessage 'ownership-modal-open'}}"
    >
      <h1 class="p-title">
        {{fa-icon "times" size="sm"}}
        Exclusion List
      </h1>
      <table class="w-100">
        <tbody>
          {{#each exclusionListEntities as |entity|}}
            <tr>
              <td>
                <span style="color: rgb(249, 123, 6)">
                  {{entity}}
                </span>
              </td>
            </tr>
          {{/each}}
        </tbody>
      </table>
    </div>
  {{/if}}

  {{#if (or newIocs.length newIocsToSubmit.length isNotInMyOwner)}}
    <div class="title-with-button">
      <h1 class="p-title">
        {{fa-icon "sparkles" size="sm" fixedWidth=true}}
        Not Currently In ThreatConnect
      </h1>
      {{#if newIocs.length}}
        <button
          class="no-style-button add"
          {{action "addAllSubmitItems"}}
          title="Add all IOCs to Submission List"
          disabled={{interactionDisabled}}
        >
          Add All
        </button>
      {{/if}}
    </div>
    <table class="w-100">
      <tbody>
        {{#each newIocs as |entity|}}
          <tr>
            <td>
              <span>{{entity.value}}</span>
            </td>
            <td class="type">
              <span>{{entity.displayedType}}</span>
            </td>
            <td class="icon">
              <button
                class="no-style-button add"
                {{action "addSubmitItem" entity}}
                title="Add IOC to Submission List"
                disabled={{interactionDisabled}}
              >
                {{fa-icon "plus" fixedWidth=true}}
              </button>
            </td>
          </tr>
        {{/each}}
      </tbody>
    </table>

    {{#if (not newIocs.length)}}
      <div class="note">
        <span class="p-key"><em>NONE</em></span>
      </div>
    {{/if}}
    <div class="title-with-button">
      <h1 class="p-title">
        {{fa-icon "upload" size="sm" fixedWidth=true}}
        To Be Submitted to&nbsp;
        {{#if newIocsToSubmit.length}}
          <span class="show-threatconnect">
            ThreatConnect
          </span>
          <span class="show-tc">
            TC
          </span>
        {{else}}
          <span>
            ThreatConnect
          </span>
        {{/if}}
      </h1>
      {{#if newIocsToSubmit.length}}
        <button
          class="no-style-button remove"
          title="Remove all IOCs from Submission List"
          {{action "removeAllSubmitItems"}}
          disabled={{interactionDisabled}}
        >
          Remove All
        </button>
      {{/if}}
    </div>

    <table class="w-100">
      <tbody>
        {{#each newIocsToSubmit as |entity|}}
          <tr>
            <td>
              <span>
                {{#if entity.resultsFound}}
                  <a
                    href="{{details.uiUrl}}/auth/indicators/details/{{entity.linkType}}.xhtml?{{entity.linkType}}={{entity.uriEncodedValue}}"
                  >
                    {{entity.value}}
                    {{fa-icon "external-link" fixedWidth=true class="external-link-icon"}}
                  </a>
                {{else}}
                  {{entity.value}}
                {{/if}}
              </span>
            </td>
            <td class="type">
              <span>
                {{entity.displayedType}}
              </span>
            </td>
            <td class="icon">
              <button
                class="no-style-button remove"
                title="Remove IOC from Submission List"
                {{action "removeSubmitItem" entity}}
                disabled={{interactionDisabled}}
              >
                {{fa-icon "minus" fixedWidth=true}}
              </button>
            </td>
          </tr>
        {{/each}}
      </tbody>
    </table>
    {{#if (not newIocsToSubmit.length)}}
      <div class="note">
        <span class="p-key"><em>NONE</em></span>
      </div>
    {{/if}}
    <h1 class="p-title">
      Submission Options
    </h1>
    {{!-- Owner Select --}}
    <div class="input-container">
      <label class="small ifta-label">
        Owner
      </label>
      {{#if allOwners.length}}
        {{#power-select
                eventType="click"
                rootEventType="click"
                triggerClass="form-control ifta-field integration-power-select-trigger"
                dropdownClass="integration-power-select-dropdown"
                selected=owner
                options=allOwners
                searchEnabled=true
                searchField="name"
                placeholder="Select owner"
                closeOnSelect=true
                disabled=interactionDisabled
                onChange=(action (mut owner))
        as |owner|
        }}
          {{owner.name}} ({{owner.type}})
        {{/power-select}}
      {{/if}}
    </div>
    
    {{!-- Title Input --}}
    <div class="input-container">
      <label class="small ifta-label">
        Title
        <span class="required">*</span>
      </label>
      {{input
        class=(concat "ifta-field" (if uiElement.error " error"))
        value=title
        placeholder="Enter a title"
        disabled=interactionDisabled
        required=true
      }}
    </div>
  
    {{!-- Description Input --}}
    <div class="input-container text-area-container {{if interactionDisabled "disabled"}} {{if uiElement.error "error"}}">
      <label class="small">
        Description
      </label>
      {{textarea
          class="ifta-field"
          rows=5
          placeholder="Enter a description"
          value=description
          disabled=interactionDisabled
          required=false
      }}
    </div>
  
    {{!-- Source Input --}}
    <div class="input-container">
      <label class="small ifta-label">
        Source
      </label>
      {{input
        class=(concat "ifta-field" (if uiElement.error " error"))
        value=source
        placeholder="Enter a source"
        disabled=interactionDisabled
        required=false
      }}
    </div>
    
    {{!-- Rating --}}
    <div class="mb-2">
      <div class="p-key">Rating &nbsp;</div>
      <div>
        {{fa-icon "ban" click=(action "setRating" 0) class="rating-icon"}}
        {{#each (repeat 5) as |empty ratingIndex|}}
          {{fa-icon
            "skull"
            class=(if
              (lt ratingIndex rating)
              "rating-icon rating-icon-filled"
              "rating-icon rating-icon-empty"
            )
            click=(action "setRating" (inc ratingIndex))
          }}
        {{/each}}
        {{ratingHuman}}
      </div>
    </div>
    
    {{!-- Confidence Slider --}}
    <div class="confidence">
      <span class="p-key">Confidence: &nbsp;</span>
      <span class="p-value">{{confidence}} - {{confidenceHuman}}</span>
      <div>
        <input
          type="range"
          oninput={{action "setConfidence" value="target.value"}}
          min="0"
          max="100"
          value={{confidence}}
          steps="1"
        />
      </div>
    </div>

    {{!-- Associated Groups --}}
    {{#if block.userOptions.allowAssociation}}
      <div class="d-flex align-items-center justify-content-start">
        <h1 class="p-title align-self-baseline">
          Associated Groups
        </h1>
        {{#unless (or editingGroups interactionDisabled)}}
          <button class="btn icon-btn p-action align-self-baseline" {{action (toggle "editingGroups" this)}} title="Edit Groups">
            {{fa-icon icon="plus-circle" fixedWidth=true}} Edit Groups
          </button>
        {{/unless}}
      </div>
      {{#if (eq selectedGroups.length 0)}}
        <div class="p-footnote">
          No Associated Groups
        </div>
      {{else}}
        {{#each selectedGroups as |group groupIndex|}}
            <div class="associated-group-container">
              <div class="d-flex align-items-start justify-content-between">
                <div class="mr-1">
                  {{group.name}}
                </div>
                {{#if (not interactionDisabled)}}
                  <div class="remove-icon" {{action "removeGroup" group}}>
                    {{fa-icon "times" class="tag-close-icon" fixedWidth=true}}
                  </div>
                {{/if}}
              </div>
              <div class="p-footnote">
                <div>Owner: {{group.ownerName}}</div>
                <div>Type: {{group.type}}</div>
              </div>
            </div>
        {{/each}}
      {{/if}}
      {{#if editingGroups}}
        <div class="add-container">
          <h1 class="p-title secondary">
            Group Filters
          </h1>
          <div class="input-container mb-2">
            <label class="small ifta-label">
              Owner Filter
            </label>
            {{#power-select-multiple
                eventType="click"
                rootEventType="click"
                triggerClass="integration-power-select-trigger integration-power-select-multiple"
                dropdownClass="integration-power-select-dropdown"
                selected=ownerFilter
                options=allOwners
                searchEnabled=true
                placeholder="No owner filter applied"
                closeOnSelect=true
                disabled=interactionDisabled
                onChange=(action (mut ownerFilter))
            as |owner|
            }}
              {{owner.name}} ({{owner.type}})
            {{/power-select-multiple}}
          </div>
          
          <div class="input-container mb-2">
            <label class="small ifta-label">
              Group Type Filter
            </label>
            {{#power-select-multiple
              eventType="click"
              rootEventType="click"
              triggerClass="integration-power-select-trigger integration-power-select-multiple"
              dropdownClass="integration-power-select-dropdown"
              selected=groupTypeFilter
              options=groupTypeNames
              searchEnabled=true
              placeholder="No group type filter applied"
              closeOnSelect=true
              disabled=interactionDisabled
              onChange=(action (mut groupTypeFilter))
            as |groupType|
            }}
              {{groupType}}
            {{/power-select-multiple}}
          </div>
    
          <div class="input-container">
            <label class="small ifta-label">
              Assoc. Group
            </label>
            {{#power-select
              eventType="click"
              rootEventType="click"
              triggerClass="form-control ifta-field integration-power-select-trigger"
              dropdownClass="integration-power-select-dropdown"
              searchEnabled=true
              search=(action "searchGroups")
              selected=selectedGroup
              options=groups
              searchEnabled=true
              searchField="name"
              placeholder="Select owner"
              closeOnSelect=true
              disabled=interactionDisabled
              onChange=(action (mut selectedGroup))
            as |group|
            }}
              {{group.name}} ({{group.ownerName}})
            {{/power-select}}
          </div>
          <div class="d-flex align-items-center justify-content-end mb-1">
            <button 
              class="btn btn-naked p-btn short outline" 
              {{action (toggle "editingGroups" this)}}
              disabled={{interactionDisabled}}
            >
              Close
            </button>
            <button
              class="btn btn-polarity p-btn short outline"
              {{action "addGroup"}}
              disabled={{interactionDisabled}}
            >
              Add Group
            </button>
          </div>
        </div>
      {{/if}}
    {{/if}}

    {{!-- Host Specific Options --}}
    {{#if entitiesToSubmitIncludeDomain}}
      <h1 class="p-title">
        Host Specific Options
      </h1>
      <div class="checkbox-container">
        <label class="d-flex align-items-center">
          <input
                  type="checkbox"
            {{on "change" (action (mut whoisActive) value="target.checked")}}
                  disabled={{interactionDisabled}}
          />
          <span class="p-value ml-1">Enable Whois Lookups</span>
        </label>
      </div>
      <div class="checkbox-container">
        <label class="d-flex align-items-center">
          <input
                  type="checkbox"
            {{on "change" (action (mut dnsActive) value="target.checked")}}
                  disabled={{interactionDisabled}}
          />
          <span class="p-value ml-1">Enable DNS Tracking</span>
        </label>
      </div>
    {{/if}}
  
    {{!-- Associated Tags --}}
    <div>
      <div class="d-flex align-items-center justify-content-start">
        <h1 class="p-title align-self-baseline">
          Associated Tags
        </h1>
        {{#unless (or editingTags interactionDisabled)}}
          <button class="btn icon-btn p-action align-self-baseline" {{action (toggle "editingTags" this)}} title="Edit Tags">
            {{fa-icon icon="plus-circle" fixedWidth=true}} Edit Tags
          </button>
        {{/unless}}
      </div>
      {{#if (eq selectedTags.length 0)}}
        <div class="p-footnote">
          No Tags
        </div>
      {{else}}
        {{#each (take maxTagsInBlock selectedTags) as |tag tagIndex|}}
          {{#if tag.isNew}}
            <span class="tag link-tag d-inline-flex align-items-center">
              <span
                class="text-container threatconnect-summary-tag
                  {{unless interactionDisabled ' rounded-borders'}}"
              >
                {{tag.name}}
                {{#if (not interactionDisabled)}}
                  <span class="remove-icon-container" {{action "deleteTag" tag}}>
                    {{fa-icon "times" class="tag-close-icon" fixedWidth=true}}
                  </span>
                {{/if}}
              </span>
            </span>
          {{else}}
            <a
              href="{{details.uiUrl}}/auth/tags/tag.xhtml?tag={{tag.name}}&owner={{details.owner.name}}"
              class="tag link-tag d-inline-flex align-items-center"
            >
              <span
                class="text-container threatconnect-summary-tag
                  {{unless interactionDisabled ' rounded-borders'}}"
              >
                {{tag.name}}
                {{#if (not interactionDisabled)}}
                  <span class="remove-icon-container" {{action "deleteTag" tag}}>
                    {{fa-icon "times" class="tag-close-icon" fixedWidth=true}}
                  </span>
                {{/if}}
              </span>
            </a>
          {{/if}}
        {{/each}}
      {{/if}}

      {{#if editingTags}}
        <div class="show-tag-modal">
          <div>
            {{#power-select-multiple
              eventType="click"
              rootEventType="click"
              triggerClass="integration-power-select-trigger integration-power-select-multiple"
              dropdownClass="integration-power-select-dropdown"
              selected=selectedTag
              options=existingTags
              searchEnabled=true
              search=(action "searchTags")
              placeholder="Search Tags"
              searchField="name"
              searchMessage="Loading Tags ..."
              loadingMessage="Loading Tags ..."
              searchPlaceholder="Search tags"
              closeOnSelect=true
              disabled=interactionDisabled
              onOpen=(action "searchTags" "")
              onChange=(action (mut selectedTag))
              as |tag|
            }}
              <span class="p-tag" 
                    style="display: inline-block;
                      font-weight: normal;
                      word-break: break-word;
                      line-height: 1.2em;
                      font-size: 12px;
                      background-color: #fff;
                      border: 1px solid #e4e9f2;
                      padding: 2px 10px;
                      border-radius: 16px;
                      margin: 0px;
                      color: #07213a;"
              >
                {{#if tag.techniqueId}}
                  &#38;
                  {{tag.techniqueId}}
                  -
                {{/if}}
                {{tag.name}}
                <span style="position: relative;">
                  {{#if tag.isNew}}
                    {{fa-icon "plus-circle" fixedWidth=true}}
                  {{/if}}
                </span>
              </span>
            {{/power-select-multiple}}
          </div>
          <div class="d-flex align-items-center justify-content-end mb-1 mt-2">
            <button
              class="btn btn-naked p-btn short outline"
              {{action (toggle "editingTags" this)}}
              disabled={{interactionDisabled}}
            >
              Cancel
            </button>
            <button
              class="btn btn-polarity p-btn short outline"
              {{action "addTags"}}
              disabled={{interactionDisabled}}
            >
              Add Tags
            </button>
          </div>
        </div>
      {{/if}}
    </div>

    <div class="d-flex flex-row-reverse justify-content-between align-items-center mt-2">
      <button 
        class="btn btn-polarity p-btn"
        {{action "submitItems"}}
        disabled={{interactionDisabled}}
      >
        {{#if createIsRunning}}
          {{fa-icon icon="spinner-third" spin=true fixedWidth=true}}
        {{else}}
          Submit IOCs
        {{/if}}
      </button>

      {{#if createMessage}}
        <div class="create-message alert alert-info m-0">
          {{createMessage}}
        </div>
      {{/if}}

      {{#if createErrorMessage}}
        <div class="create-message alert alert-danger m-0">
          {{createErrorMessage}}
        </div>
      {{/if}}

      {{#if createWarningMessage}}
        <div class="create-message alert alert-warning m-0">
          {{createWarningMessage}}
        </div>
      {{/if}}
    </div>
  {{/if}}
</div>

{{#if
  (and
    (not foundEntities.length)
    (not (or newIocs.length newIocsToSubmit.length))
    (not exclusionListEntities.length)
  )
}}
  <div class="note">
    <span class="p-key"><em>All Already In ThreatConnect IOCs have been deleted</em></span>
  </div>
{{/if}}